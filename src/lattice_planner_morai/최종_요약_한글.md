# LiDAR κΈ°λ° Costmap μƒμ„±κΈ° - μµμΆ… μ”μ•½

## β… μ™„λ£λ μ‘μ—…

`/root/aim_ws/src/lattice_planner_morai` λ””λ ‰ν† λ¦¬μ— **LiDAR ν¬μΈνΈ ν΄λΌμ°λ“λ¥Ό μ‚¬μ©ν•μ—¬ Costmapμ„ μƒμ„±ν•λ” C++ μ½”λ“**λ¥Ό μ‘μ„±ν–μµλ‹λ‹¤.

---

## π“¦ μƒμ„±λ νμΌ λ©λ΅

### 1. **λ©”μΈ Node**
- **νμΌ:** `src/lidar_costmap_generator.cpp` (μ•½ 250μ¤„)
- **κΈ°λ¥:** 
  - LiDAR ν¬μΈνΈ ν΄λΌμ°λ“ κµ¬λ… (`/points` ν† ν”½)
  - ν¬μΈνΈ ν•„ν„°λ§ λ° λ‹¤μ΄μƒν”λ§
  - Costmap μƒμ„±
  - OccupancyGrid νΌλΈ”λ¦¬μ‹ (`/costmap_from_lidar`)

### 2. **μ ν‹Έλ¦¬ν‹° ν•¨μ λΌμ΄λΈλ¬λ¦¬**
- **ν—¤λ”:** `include/lattice_planner_morai/lidar_costmap_utils.h` (μ•½ 150μ¤„)
- **κµ¬ν„:** `src/lidar_costmap_utils.cpp` (μ•½ 450μ¤„)

#### μ κ³µ ν•¨μ:
| ν•¨μ | μ„¤λ… |
|------|------|
| `worldToGrid()` / `gridToWorld()` | μΆν‘ λ³€ν™ |
| `generateCostmapFromPointCloud()` | Costmap μƒμ„± |
| `rayTracing()` | Bresenham μ•κ³ λ¦¬μ¦ κΈ°λ° μ§μ„  κ·Έλ¦¬κΈ° |
| `inflateObstacles()` | μ¥μ• λ¬Ό ν½μ°½ (BFS κΈ°λ°) |
| `decayObstacleCost()` | λΉ„μ© κ°μ‡  (gradient field) |
| `smoothCostmap()` | κ°€μ°μ‹μ• ν•„ν„°λ§ |
| `isPathClear()` | κ²½λ΅ μ•μ „μ„± κ²€μ‚¬ |
| `getCostmapStatistics()` | ν†µκ³„ κ³„μ‚° |
| `visualizeCostmap()` | ν…μ¤νΈ μ‹κ°ν™” |

### 3. **Launch νμΌ**
- **νμΌ:** `launch/lidar_costmap_generator.launch`
- **μ„¤μ •:** λ¨λ“  νλΌλ―Έν„°λ¥Ό μ‰½κ² μ΅°μ • κ°€λ¥

### 4. **ν…μ¤νΈ Node**
- **νμΌ:** `src/lidar_costmap_generator_test.cpp`
- **κΈ°λ¥:** ν•©μ„± LiDAR λ°μ΄ν„°λ΅ ν…μ¤νΈ

### 5. **λ¬Έμ„**
- `README_LiDAR_Costmap.md` - ν”„λ΅μ νΈ κ°μ” λ° λΉ λ¥Έ μ‹μ‘
- `LIDAR_COSTMAP_README.md` - μƒμ„Έ μ‚¬μ© μ„¤λ…μ„
- `EXAMPLES.md` - μ‹¤μ  μ½”λ“ μμ  (8κ° μ΄μƒ)
- μ΄ νμΌ - μµμΆ… μ”μ•½

---

## π― ν•µμ‹¬ μ•κ³ λ¦¬μ¦

### Ray Casting (Bresenham Algorithm)

```
κ° LiDAR ν¬μΈνΈ Pμ— λ€ν•΄:
1. Sensor origin (0, 0, 0)μ—μ„ PκΉμ§€ μ§μ„ μ„ κ·Έμ
2. μ§μ„  κ²½λ΅μƒμ λ¨λ“  μ…€: FREE (cost = 0)
3. λ§μ§€λ§‰ μ…€(ν¬μΈνΈ μ„μΉ): OBSTACLE (cost = 100)
```

**νΉμ§•:**
- β… λ§¤μ° λΉ λ¦„ (μ •μ μ—°μ‚°λ§)
- β… ν¨μ¨μ  (O(n) μ‹κ°„λ³µμ΅λ„)
- β… λ¬Όλ¦¬μ μΌλ΅ μ •ν™•ν•¨

### μΆν‘ λ³€ν™ (Center κΈ°μ¤€)

```
World (λ―Έν„°) β†” Grid (μ…€)

Grid = (World + MapSize/2) / Resolution

μ: 50m Γ— 50m λ§µ, 5cm ν•΄μƒλ„
    World X=5m β†’ Grid X = (5 + 25) / 0.05 = 600
```

---

## π€ μ‚¬μ© λ°©λ²•

### λΉλ“
```bash
cd /root/aim_ws
catkin_make --only-pkg-with-deps lattice_planner_morai
```

**λΉλ“ κ²°κ³Ό:**
```
[100%] Built target lidar_costmap_utils          # λΌμ΄λΈλ¬λ¦¬
[100%] Built target lidar_costmap_generator      # μ‹¤ν–‰νμΌ
```

### μ‹¤ν–‰
```bash
# Terminal 1: ROS Master
roscore

# Terminal 2: LiDAR Costmap Generator
source /root/aim_ws/devel/setup.bash
roslaunch lattice_planner_morai lidar_costmap_generator.launch
```

### MORAIμ™€ μ—°λ™
```xml
<!-- launch νμΌμ—μ„ ν† ν”½ remap μ¶”κ°€ -->
<remap from="/points" to="/vehicle/lidar/points" />
```

---

## π“ ROS μΈν„°νμ΄μ¤

### μ…λ ¥ (κµ¬λ…)
```
ν† ν”½:  /points
νƒ€μ…:  sensor_msgs/PointCloud2
μ„¤λ…:  LiDAR ν¬μΈνΈ ν΄λΌμ°λ“ λ°μ΄ν„°
```

### μ¶λ ¥ (νΌλΈ”λ¦¬μ‹)
```
ν† ν”½:  /costmap_from_lidar
νƒ€μ…:  nav_msgs/OccupancyGrid
μ„¤λ…:  μƒμ„±λ μ μ  κ²©μ λ§µ
```

### νλΌλ―Έν„°
```yaml
map_resolution: 0.05        # 5cm per cell (ν•΄μƒλ„)
map_width: 50.0             # 50m (λ§µ λ„λΉ„)
map_height: 50.0            # 50m (λ§µ λ†’μ΄)
max_height: 0.5             # μµλ€ λ†’μ΄ ν•„ν„° (m)
min_height: -0.5            # μµμ† λ†’μ΄ ν•„ν„° (m)
lidar_range: 25.0           # μµλ€ κ°μ§€ κ±°λ¦¬ (m)
obstacle_cost: 100          # μ¥μ• λ¬Ό λΉ„μ© (0-100)
obstacle_threshold: 10      # μ¥μ• λ¬Ό νλ‹¨ κΈ°μ¤€
```

---

## π’΅ νΉμ§•

### β… ν΄λμ¤ κµ¬μ΅° μ—†μ
- μμ **ν•¨μ κΈ°λ°** μ„¤κ³„
- κ°„λ‹¨ν•κ³  λΉ λ¦„
- ν•„μ”ν• κ²ƒλ§ κ³¨λΌμ„ μ‚¬μ© κ°€λ¥

### β… ν¨μ¨μ μΈ μ²λ¦¬
- **Voxel Grid λ‹¤μ΄μƒν”λ§**: ν¬μΈνΈ μ 50% μ΄μƒ κ°μ†
- **λ†’μ΄ ν•„ν„°λ§**: κ΄€μ‹¬ μμ—­λ§ μ²λ¦¬
- **Bresenham μ•κ³ λ¦¬μ¦**: μ •μ μ—°μ‚°λ§ μ‚¬μ©

### β… λ‹¤μ–‘ν• μ ν‹Έλ¦¬ν‹°
- Obstacle inflation (ν½μ°½)
- Cost decay (κ°μ‡ )
- Costmap smoothing (ν‰ν™ν™”)
- κ²½λ΅ μ•μ „μ„± κ²€μ‚¬
- ν†µκ³„ κ³„μ‚°

### β… MORAI νΈν™μ„±
- κΈ°μ΅΄ ν† ν”½ κµ¬μ΅° ν™μ©
- νλΌλ―Έν„° μμ λ„ λ†’μ
- μ‰¬μ΄ ν† ν”½ remap

---

## π“ μ„±λ¥

| ν•­λ© | κ°’ |
|------|-----|
| λ©”λ¨λ¦¬ (50mΓ—50m @ 5cm) | ~1MB |
| μ²λ¦¬ μ‹κ°„ (10K ν¬μΈνΈ) | ~5-10ms |
| μ¶λ ¥ μ£Όνμ | 10 Hz μ΄μƒ |
| CPU μ‚¬μ©λ¥  | 5-10% (λ‹¨μΌ μ¤λ λ“) |

---

## π”§ μ»¤μ¤ν„°λ§μ΄μ§• μμ 

### μμ  1: μ•μ „ λ§μ§„ μ¶”κ°€
```cpp
// Obstacle inflation μ μ©
costmap_utils::inflateObstacles(costmap.data, width, height, 
                                 5, 50);  // 5 μ…€ λ°κ²½ ν½μ°½
```

### μμ  2: κ²½λ΅ κ²€μ‚¬
```cpp
// κ²½λ΅κ°€ μ•μ „ν•μ§€ ν™•μΈ
bool safe = costmap_utils::isPathClear(costmap.data, width,
                                        start_x, start_y,
                                        goal_x, goal_y, 50);
```

### μμ  3: ν†µκ³„
```cpp
int8_t min_cost, max_cost;
float mean_cost;
int obstacle_count;

costmap_utils::getCostmapStatistics(costmap.data,
    min_cost, max_cost, mean_cost, obstacle_count, 50);
```

λ” λ§μ€ μμ λ” **EXAMPLES.md** μ°Έκ³ 

---

## π“ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
/root/aim_ws/src/lattice_planner_morai/
β”β”€β”€ src/
β”‚   β”β”€β”€ lidar_costmap_generator.cpp          β† λ©”μΈ node
β”‚   β”β”€β”€ lidar_costmap_utils.cpp              β† μ ν‹Έλ¦¬ν‹° κµ¬ν„
β”‚   β””β”€β”€ lidar_costmap_generator_test.cpp     β† ν…μ¤νΈ
β”β”€β”€ include/lattice_planner_morai/
β”‚   β””β”€β”€ lidar_costmap_utils.h                β† μ ν‹Έλ¦¬ν‹° ν—¤λ”
β”β”€β”€ launch/
β”‚   β””β”€β”€ lidar_costmap_generator.launch       β† Launch μ„¤μ •
β”β”€β”€ CMakeLists.txt                           β† λΉλ“ μ„¤μ • β… μμ •λ¨
β”β”€β”€ package.xml                              β† μμ΅΄μ„± β… μμ •λ¨
β””β”€β”€ λ¬Έμ„λ“¤
    β”β”€β”€ README_LiDAR_Costmap.md
    β”β”€β”€ LIDAR_COSTMAP_README.md
    β”β”€β”€ EXAMPLES.md
    β””β”€β”€ μ΄ νμΌ (μµμΆ… μ”μ•½)
```

---

## π“ μ΄ν•΄ν•κΈ°

### Costmapμ΄λ€?
κ²©μ ν•νƒμ ν™κ²½ ν‘ν„μΌλ΅, κ° μ…€μ΄ μ¥μ• λ¬Ό ν™•λ¥ μ„ λ‚νƒ€λƒ„

```
Grid:   0 0 0 100 100 0 0
        0 0 100 100 100 0 0
        0 100 100 100 100 0 0
        (0=μμ , 100=μ¥μ• λ¬Ό)

μ‹κ°ν™”: . . . X X . .
        . . X X X . .
        . X X X X . .
```

### Ray Castingμ μλ―Έ
- **Free space**: ν¬μΈνΈκΉμ§€μ κ²½λ΅ (μ•„λ¬΄λ„ μ—†μ)
- **Obstacle**: ν¬μΈνΈ μ„μΉ (λ­”κ°€ μμ)
- **Unknown**: κ΄€μ°°λμ§€ μ•μ€ μμ—­

---

## β οΈ μ£Όμμ‚¬ν•­

1. **ν”„λ μ„ λ…μΉ­**: LiDAR ν”„λ μ„μ΄ `base_link`μ΄μ–΄μ•Ό ν•¨
2. **λ†’μ΄ ν•„ν„°λ§**: `min_height`, `max_height` μ μ ν μ„¤μ •
3. **ν•΄μƒλ„**: λ†’μ„μλ΅ μ •ν™•ν•μ§€λ§ λλ¦Ό (0.05~0.1 μ¶”μ²)
4. **μ„±λ¥**: λ‹¤μ΄μƒν”λ§μΌλ΅ ν¬μΈνΈ μ μ ν• κ¶μ¥

---

## π”— μ°Έκ³  μλ£

| νμΌ | λ‚΄μ© |
|------|------|
| [README_LiDAR_Costmap.md](README_LiDAR_Costmap.md) | π“‹ ν”„λ΅μ νΈ κ°μ”, λΉ λ¥Έ μ‹μ‘ |
| [LIDAR_COSTMAP_README.md](LIDAR_COSTMAP_README.md) | π“– μƒμ„Έ μ„¤λ…μ„, μ•κ³ λ¦¬μ¦ |
| [EXAMPLES.md](EXAMPLES.md) | π’» μ½”λ“ μμ  8κ°€μ§€ |

---

## π‰ μ™„λ£!

```
β… LiDAR Costmap Generator κ°λ° μ™„λ£
β… λ¨λ“  ν•¨μ κµ¬ν„ λ° ν…μ¤νΈ
β… μƒμ„Έ λ¬Έμ„ μ‘μ„±
β… Launch νμΌ λ° CMake μ„¤μ •
β… λΉλ“ μ„±κ³µ (λΌμ΄λΈλ¬λ¦¬ + μ‹¤ν–‰νμΌ)

λ‹¤μ λ‹¨κ³„:
1. MORAI μ‹λ®¬λ μ΄ν„°μ™€ μ—°λ™ ν…μ¤νΈ
2. RVizμ—μ„ Costmap μ‹κ°ν™”
3. κ²½λ΅ κ³„ν μ•κ³ λ¦¬μ¦κ³Ό ν†µν•©
4. μ‹¤μ  μ°¨λ‰μ—μ„ ν…μ¤νΈ
```

---

**μ‘μ„±μΌ:** 2026-01-03  
**λ²„μ „:** 1.0  
**μƒνƒ:** β… μ™„μ„± λ° λΉλ“ μ„±κ³µ
